<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>輔具補助計算器 V16</title>
  
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#4A90E2">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="./icon.png">

  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <style>
    * { -webkit-tap-highlight-color: transparent; }
    body { touch-action: manipulation; }
    .no-scrollbar::-webkit-scrollbar { display: none; }
    .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body class="bg-gray-100">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useMemo } = React;

    // --- 圖示組件 ---
    const IconBase = ({ children, size = 18, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        {children}
      </svg>
    );
    const Trash2 = (p) => <IconBase {...p}><path d="M3 6h18M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2M10 11v6M14 11v6" /></IconBase>;
    const Plus = (p) => <IconBase {...p}><path d="M12 5v14M5 12h14" /></IconBase>;
    const RotateCcw = (p) => <IconBase {...p} size={48}><path d="M1 4v6h6M3.51 15a9 9 0 1 0 2.13-9.36L1 10" /></IconBase>;
    const CheckSquare = (p) => <IconBase {...p}><path d="M9 11l3 3L22 4M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" /></IconBase>;
    const Square = (p) => <IconBase {...p}><path d="M18 3H6a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3h12a3 3 0 0 0 3-3V6a3 3 0 0 0-3-3z" /></IconBase>;
    const Smartphone = (p) => <IconBase {...p} size={80}><path d="M5 2h14a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2zm7 15h.01" /></IconBase>;
    const ChevronUp = (p) => <IconBase {...p}><path d="M18 15l-6-6-6 6" /></IconBase>;
    const ChevronDown = (p) => <IconBase {...p}><path d="M6 9l6 6 6-6" /></IconBase>;
    const CheckCircle = (p) => <IconBase {...p}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></IconBase>;
    const Circle = (p) => <IconBase {...p}><circle cx="12" cy="12" r="10"></circle></IconBase>;

    // --- 1. 資料庫 ---
    // 輔具資料
    const EQUIP_DB = [
      {"id": "p0", "name": "EB03助行器(一般)", "prices": {"disability": {"一般戶": 400, "中低收": 600, "低收入戶": 800}, "ltc": {"一般戶": 560, "中低收": 720, "低收入戶": 800}}, "ltcQuota": 800},
      {"id": "p1", "name": "EB03助行器(助起/R型/輪管)", "prices": {"disability": {"一般戶": 600, "中低收": 900, "低收入戶": 1200}, "ltc": {"一般戶": 560, "中低收": 720, "低收入戶": 800}}, "ltcQuota": 800},
      {"id": "p2", "name": "EB04帶輪型助步車（助行椅）", "prices": {"disability": {"一般戶": 1500, "中低收": 2250, "低收入戶": 3000}, "ltc": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}}, "ltcQuota": 3000},
      {"id": "p3", "name": "EA01馬桶增高器", "prices": {"disability": {"一般戶": 400, "中低收": 600, "低收入戶": 800}, "ltc": {"一般戶": 840, "中低收": 1080, "低收入戶": 1200}}, "ltcQuota": 1200},
      {"id": "p4", "name": "EA01一般便盆椅", "prices": {"disability": {"一般戶": 600, "中低收": 900, "低收入戶": 1200}, "ltc": {"一般戶": 840, "中低收": 1080, "低收入戶": 1200}}, "ltcQuota": 1200},
      {"id": "p5", "name": "EA01一般沐浴椅", "prices": {"disability": {"一般戶": 450, "中低收": 675, "低收入戶": 900}, "ltc": {"一般戶": 840, "中低收": 1080, "低收入戶": 1200}}, "ltcQuota": 1200},
      {"id": "p6", "name": "EA01一般便盆椅+扶手可拆", "prices": {"disability": {"一般戶": 1100, "中低收": 1650, "低收入戶": 2200}, "ltc": {"一般戶": 840, "中低收": 1080, "低收入戶": 1200}}, "ltcQuota": 1200},
      {"id": "p7", "name": "EA01帶輪便盆椅", "prices": {"disability": {"一般戶": 1100, "中低收": 1650, "低收入戶": 2200}, "ltc": {"一般戶": 840, "中低收": 1080, "低收入戶": 1200}}, "ltcQuota": 1200},
      {"id": "p8", "name": "EA01帶輪便盆椅+扶手可拆", "prices": {"disability": {"一般戶": 1600, "中低收": 2400, "低收入戶": 3200}, "ltc": {"一般戶": 840, "中低收": 1080, "低收入戶": 1200}}, "ltcQuota": 1200},
      {"id": "p9", "name": "EA01沐浴/便盆椅附加-仰躺", "prices": {"disability": {"一般戶": 750, "中低收": 1125, "低收入戶": 1500}, "ltc": {"一般戶": 0, "中低收": 0, "低收入戶": 0}}, "ltcQuota": 0},
      {"id": "p10", "name": "EA01沐浴/便盆椅附加-空傾", "prices": {"disability": {"一般戶": 1750, "中低收": 2625, "低收入戶": 3500}, "ltc": {"一般戶": 0, "中低收": 0, "低收入戶": 0}}, "ltcQuota": 0},
      {"id": "p11", "name": "EC01輪椅A款", "prices": {"disability": {"一般戶": 1750, "中低收": 2625, "低收入戶": 3500}, "ltc": {"一般戶": 2450, "中低收": 3150, "低收入戶": 3500}}, "ltcQuota": 3500},
      {"id": "p12", "name": "EC02輪椅B款", "prices": {"disability": {"一般戶": 2000, "中低收": 3000, "低收入戶": 4000}, "ltc": {"一般戶": 2800, "中低收": 3600, "低收入戶": 4000}}, "ltcQuota": 4000},
      {"id": "p13", "name": "EC03輪椅C款", "prices": {"disability": {"一般戶": 9000, "中低收": 9000, "低收入戶": 9000}, "ltc": {"一般戶": 9000, "中低收": 9000, "低收入戶": 9000}}, "ltcQuota": 9000},
      {"id": "p14", "name": "EC04輪椅B+A(利移位)", "prices": {"disability": {"一般戶": 7000, "中低收": 8000, "低收入戶": 9000}, "ltc": {"一般戶": 7800, "中低收": 8600, "低收入戶": 9000}}, "ltcQuota": 9000},
      {"id": "p15", "name": "EC05輪椅B+AB(仰躺)", "prices": {"disability": {"一般戶": 9000, "中低收": 10000, "低收入戶": 11000}, "ltc": {"一般戶": 9800, "中低收": 10600, "低收入戶": 11000}}, "ltcQuota": 11000},
      {"id": "p16", "name": "EC06輪椅B+AC(空傾)", "prices": {"disability": {"一般戶": 11000, "中低收": 12000, "低收入戶": 13000}, "ltc": {"一般戶": 11800, "中低收": 12600, "低收入戶": 13000}}, "ltcQuota": 13000},
      {"id": "p17", "name": "EC06輪椅B+ABC(全包)", "prices": {"disability": {"一般戶": 13000, "中低收": 14000, "低收入戶": 15000}, "ltc": {"一般戶": 13800, "中低收": 14600, "低收入戶": 15000}}, "ltcQuota": 15000},
      {"id": "p18", "name": "EC10輪椅B+ABC+D(VIP2)", "prices": {"disability": {"一般戶": 15500, "中低收": 16500, "低收入戶": 17500}, "ltc": {"一般戶": 16300, "中低收": 17100, "低收入戶": 17500}}, "ltcQuota": 17500},
      {"id": "p19", "name": "EC03輪椅C+A", "prices": {"disability": {"一般戶": 14000, "中低收": 14000, "低收入戶": 14000}, "ltc": {"一般戶": 14000, "中低收": 14000, "低收入戶": 14000}}, "ltcQuota": 14000},
      {"id": "p20", "name": "ECO後推式介護套件", "prices": {"disability": {"一般戶": 4000, "中低收": 6000, "低收入戶": 8000}, "ltc": {"一般戶": 0, "中低收": 0, "低收入戶": 0}}, "ltcQuota": 0},
      {"id": "p21", "name": "ECO衝擊測試", "prices": {"disability": {"一般戶": 1500, "中低收": 2250, "低收入戶": 3000}, "ltc": {"一般戶": 0, "中低收": 0, "低收入戶": 0}}, "ltcQuota": 0},
      {"id": "p22", "name": "EH手動病床(高度固定-雙搖桿)", "prices": {"disability": {"一般戶": 4500, "中低收": 6750, "低收入戶": 9000}, "ltc": {"一般戶": 5600, "中低收": 7200, "低收入戶": 8000}}, "ltcQuota": 8000},
      {"id": "p23", "name": "EH手動病床(高低可調-三搖桿)", "prices": {"disability": {"一般戶": 6500, "中低收": 9750, "低收入戶": 13000}, "ltc": {"一般戶": 9100, "中低收": 11700, "低收入戶": 13000}}, "ltcQuota": 13000},
      {"id": "p24", "name": "EH雙馬達照顧床", "prices": {"disability": {"一般戶": 6000, "中低收": 9000, "低收入戶": 12000}, "ltc": {"一般戶": 9100, "中低收": 11700, "低收入戶": 13000}}, "ltcQuota": 13000},
      {"id": "p25", "name": "EH三馬達照顧床", "prices": {"disability": {"一般戶": 9000, "中低收": 13500, "低收入戶": 18000}, "ltc": {"一般戶": 12600, "中低收": 16200, "低收入戶": 18000}}, "ltcQuota": 18000},
      {"id": "p26", "name": "EH三馬達照顧床(高升降)", "prices": {"disability": {"一般戶": 10500, "中低收": 15750, "低收入戶": 21000}, "ltc": {"一般戶": 12600, "中低收": 16200, "低收入戶": 18000}}, "ltcQuota": 18000},
      {"id": "p27", "name": "EH古洛奇電動床墊", "prices": {"disability": {"一般戶": 0, "中低收": 0, "低收入戶": 0}, "ltc": {"一般戶": 9100, "中低收": 11700, "低收入戶": 13000}}, "ltcQuota": 13000},
      {"id": "p28", "name": "EG02氣墊床基礎型=氣墊床B款", "prices": {"disability": {"一般戶": 10000, "中低收": 10000, "低收入戶": 10000}, "ltc": {"一般戶": 12000, "中低收": 12000, "低收入戶": 12000}}, "ltcQuota": 12000},
      {"id": "p29", "name": "EG02氣墊床進階型", "prices": {"disability": {"一般戶": 14000, "中低收": 14000, "低收入戶": 14000}, "ltc": {"一般戶": 12000, "中低收": 12000, "低收入戶": 12000}}, "ltcQuota": 12000},
      {"id": "p30", "name": "EG03輪椅座墊A", "prices": {"disability": {"一般戶": 5000, "中低收": 5000, "低收入戶": 5000}, "ltc": {"一般戶": 5000, "中低收": 5000, "低收入戶": 5000}}, "ltcQuota": 5000},
      {"id": "p31", "name": "EG04輪椅座墊B", "prices": {"disability": {"一般戶": 8000, "中低收": 8000, "低收入戶": 8000}, "ltc": {"一般戶": 10000, "中低收": 10000, "低收入戶": 10000}}, "ltcQuota": 10000},
      {"id": "p32", "name": "EG04輪椅座墊B+分區", "prices": {"disability": {"一般戶": 11000, "中低收": 11000, "低收入戶": 11000}, "ltc": {"一般戶": 10000, "中低收": 10000, "低收入戶": 10000}}, "ltcQuota": 10000},
      {"id": "p33", "name": "EG05輪椅座墊C", "prices": {"disability": {"一般戶": 8000, "中低收": 8000, "低收入戶": 8000}, "ltc": {"一般戶": 10000, "中低收": 10000, "低收入戶": 10000}}, "ltcQuota": 10000},
      {"id": "p34", "name": "EG06輪椅座墊D", "prices": {"disability": {"一般戶": 8000, "中低收": 8000, "低收入戶": 8000}, "ltc": {"一般戶": 8000, "中低收": 8000, "低收入戶": 8000}}, "ltcQuota": 8000},
      {"id": "p35", "name": "EG07輪椅座墊E", "prices": {"disability": {"一般戶": 10000, "中低收": 10000, "低收入戶": 10000}, "ltc": {"一般戶": 8000, "中低收": 8000, "低收入戶": 8000}}, "ltcQuota": 8000},
      {"id": "p36", "name": "ED01移位腰帶", "prices": {"disability": {"一般戶": 750, "中低收": 1125, "低收入戶": 1500}, "ltc": {"一般戶": 1050, "中低收": 1350, "低收入戶": 1500}}, "ltcQuota": 1500},
      {"id": "p37", "name": "ED02移位板", "prices": {"disability": {"一般戶": 1000, "中低收": 1500, "低收入戶": 2000}, "ltc": {"一般戶": 1400, "中低收": 1800, "低收入戶": 2000}}, "ltcQuota": 2000},
      {"id": "p38", "name": "ED03人力移位吊帶", "prices": {"disability": {"一般戶": 2000, "中低收": 3000, "低收入戶": 4000}, "ltc": {"一般戶": 2800, "中低收": 3600, "低收入戶": 4000}}, "ltcQuota": 4000},
      {"id": "p39", "name": "ED04土豆板=移位滑墊A", "prices": {"disability": {"一般戶": 500, "中低收": 750, "低收入戶": 1000}, "ltc": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}}, "ltcQuota": 3000},
      {"id": "p40", "name": "ED04短版滑布=移位滑墊A", "prices": {"disability": {"一般戶": 500, "中低收": 750, "低收入戶": 1000}, "ltc": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}}, "ltcQuota": 3000},
      {"id": "p41", "name": "ED05長版滑布=移位滑墊B", "prices": {"disability": {"一般戶": 500, "中低收": 750, "低收入戶": 1000}, "ltc": {"一般戶": 5600, "中低收": 7200, "低收入戶": 8000}}, "ltcQuota": 8000},
      {"id": "p42", "name": "ED05仰躺平移滑墊=移位滑墊B", "prices": {"disability": {"一般戶": 3000, "中低收": 4500, "低收入戶": 6000}, "ltc": {"一般戶": 5600, "中低收": 7200, "低收入戶": 8000}}, "ltcQuota": 8000},
      {"id": "p43", "name": "ED07移位機-人力", "prices": {"disability": {"一般戶": 15000, "中低收": 22500, "低收入戶": 30000}, "ltc": {"一般戶": 0, "中低收": 0, "低收入戶": 0}}, "ltcQuota": 0},
      {"id": "p44", "name": "ED07移位機-電動(非懸吊式)", "prices": {"disability": {"一般戶": 30000, "中低收": 45000, "低收入戶": 60000}, "ltc": {"一般戶": 0, "中低收": 0, "低收入戶": 0}}, "ltcQuota": 0},
      {"id": "p45", "name": "ED07移位機-電動(懸吊式)", "prices": {"disability": {"一般戶": 30000, "中低收": 45000, "低收入戶": 60000}, "ltc": {"一般戶": 28000, "中低收": 36000, "低收入戶": 40000}}, "ltcQuota": 40000}
    ];

    // 長照無障礙資料庫
    const LTC_CONST_DB = [
      {"id": "L01", "name": "FA01設施-扶手（每十公分）", "prices": {"一般戶": 105, "中低收": 135, "低收入戶": 150}, "quota": 150},
      {"id": "L02", "name": "FA02設施-可動式扶手（單支）", "prices": {"一般戶": 2520, "中低收": 3240, "低收入戶": 3600}, "quota": 3600},
      {"id": "L03", "name": "FA03輔具-門檻斜角 (單側)", "prices": {"一般戶": 2450, "中低收": 3150, "低收入戶": 3500}, "quota": 3500},
      {"id": "L04", "name": "FA03輔具-斜坡板A款(未達90cm)", "prices": {"一般戶": 2450, "中低收": 3150, "低收入戶": 3500}, "quota": 3500},
      {"id": "L05", "name": "FA04輔具-斜坡板B款(90cm以上)", "prices": {"一般戶": 3500, "中低收": 4500, "低收入戶": 5000}, "quota": 5000},
      {"id": "L06", "name": "FA05輔具-斜坡板C款(大於120cm)", "prices": {"一般戶": 7000, "中低收": 9000, "低收入戶": 10000}, "quota": 10000},
      {"id": "L07", "name": "FA06設施-固定式斜坡道", "prices": {"一般戶": 7000, "中低收": 9000, "低收入戶": 10000}, "quota": 10000},
      {"id": "L08", "name": "FA07設施-架高式和式地板拆除", "prices": {"一般戶": 3500, "中低收": 4500, "低收入戶": 5000}, "quota": 5000},
      {"id": "L09", "name": "FA08設施-反光貼條或消光處理", "prices": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}, "quota": 3000},
      {"id": "L10", "name": "FA09設施-隔間新增", "prices": {"一般戶": 420, "中低收": 540, "低收入戶": 600}, "quota": 600},
      {"id": "L11", "name": "FA10設施-防滑措施", "prices": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}, "quota": 3000},
      {"id": "L12", "name": "FA11設施-門A款-對門簡易型", "prices": {"一般戶": 4900, "中低收": 6300, "低收入戶": 7000}, "quota": 7000},
      {"id": "L13", "name": "FA12設施-門B款-對門進階型", "prices": {"一般戶": 7000, "中低收": 9000, "低收入戶": 10000}, "quota": 10000},
      {"id": "L14", "name": "FA11修繕-門 (簡易型)", "prices": {"一般戶": 4900, "中低收": 6300, "低收入戶": 7000}, "quota": 7000},
      {"id": "L15", "name": "FA12修繕-門 (進階型)", "prices": {"一般戶": 7000, "中低收": 9000, "低收入戶": 10000}, "quota": 10000},
      {"id": "L16", "name": "FA13設施-水龍頭", "prices": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}, "quota": 3000},
      {"id": "L17", "name": "FA14設施-改善浴缸", "prices": {"一般戶": 4900, "中低收": 6300, "低收入戶": 7000}, "quota": 7000},
      {"id": "L18", "name": "FA15設施-改善洗臉台", "prices": {"一般戶": 2100, "中低收": 2700, "低收入戶": 3000}, "quota": 3000},
      {"id": "L19", "name": "FA16設施-改善馬桶", "prices": {"一般戶": 3500, "中低收": 4500, "低收入戶": 5000}, "quota": 5000},
      {"id": "L20", "name": "FA17設施-壁掛式淋浴台", "prices": {"一般戶": 3500, "中低收": 4500, "低收入戶": 5000}, "quota": 5000},
      {"id": "L21", "name": "FA18設施-改善流理台", "prices": {"一般戶": 10500, "中低收": 13500, "低收入戶": 15000}, "quota": 15000},
      {"id": "L22", "name": "FA19設施-改善抽油煙機", "prices": {"一般戶": 700, "中低收": 900, "低收入戶": 1000}, "quota": 1000},
      {"id": "L23", "name": "FA20清洗槽-局部型(身障非環改)", "prices": {"一般戶": 1400, "中低收": 1800, "低收入戶": 2000}, "quota": 2000},
      {"id": "L24", "name": "FA21清洗槽-全身型(身障非環改)", "prices": {"一般戶": 3500, "中低收": 4500, "低收入戶": 5000}, "quota": 5000}
    ];

    // 身障無障礙資料庫
    const DIS_CONST_DB = [
      {"id": "D01", "name": "137居家無障礙設施-扶手（每十公分）", "prices": {"一般戶": 80, "中低收": 120, "低收入戶": 160}},
      {"id": "D02", "name": "138居家無障礙設施-可動式扶手（單支）", "prices": {"一般戶": 1800, "中低收": 2700, "低收入戶": 3600}},
      {"id": "D03", "name": "154居家無障礙輔具-門檻斜角 (單側)", "prices": {"一般戶": 500, "中低收": 750, "低收入戶": 1000}},
      {"id": "D04", "name": "155居家無障礙輔具-非固定式斜坡板A款(未達90cm)", "prices": {"一般戶": 1750, "中低收": 2625, "低收入戶": 3500}},
      {"id": "D05", "name": "156居家無障礙輔具-非固定式斜坡板B款(90cm以上)", "prices": {"一般戶": 2500, "中低收": 3750, "低收入戶": 5000}},
      {"id": "D06", "name": "157居家無障礙輔具-非固定式斜坡板C款(大於120cm)", "prices": {"一般戶": 3500, "中低收": 5250, "低收入戶": 7000}},
      {"id": "D07", "name": "158居家無障礙輔具-非固定式斜坡板(大於150cm)", "prices": {"一般戶": 5000, "中低收": 7500, "低收入戶": 10000}},
      {"id": "D08", "name": "160居家無障礙設施-反光貼條或消光處理（單處）", "prices": {"一般戶": 1000, "中低收": 1500, "低收入戶": 2000}},
      {"id": "D09", "name": "152居家無障礙設施-隔間(每平方公尺)新增", "prices": {"一般戶": 400, "中低收": 600, "低收入戶": 800}},
      {"id": "D10", "name": "145居家無障礙設施-防滑地磚 (單處)", "prices": {"一般戶": 3000, "中低收": 4500, "低收入戶": 6000}},
      {"id": "D11", "name": "159居家無障礙設施-防滑措施 (單處)", "prices": {"一般戶": 1000, "中低收": 1500, "低收入戶": 2000}},
      {"id": "D12", "name": "135居家無障礙修繕-門 (簡易型) (單處)", "prices": {"一般戶": 3500, "中低收": 5250, "低收入戶": 7000}},
      {"id": "D13", "name": "136居家無障礙修繕-門 (進階型) (單處)", "prices": {"一般戶": 5000, "中低收": 7500, "低收入戶": 10000}},
      {"id": "D14", "name": "139居家無障礙修繕-截水槽 (單處)", "prices": {"一般戶": 3000, "中低收": 4500, "低收入戶": 6000}},
      {"id": "D15", "name": "140居家無障礙修繕-改善高低差10公分以下 (單處)", "prices": {"一般戶": 1750, "中低收": 2625, "低收入戶": 3500}},
      {"id": "D16", "name": "141居家無障礙修繕-改善高低差20公分以下 (單處)", "prices": {"一般戶": 2500, "中低收": 3750, "低收入戶": 5000}},
      {"id": "D17", "name": "142居家無障礙修繕-改善高低差30公分以下 (單處)", "prices": {"一般戶": 3500, "中低收": 5250, "低收入戶": 7000}},
      {"id": "D18", "name": "143居家無障礙修繕-改善高低差超過30公分 (單處)", "prices": {"一般戶": 5000, "中低收": 7500, "低收入戶": 10000}},
      {"id": "D19", "name": "144居家無障礙設施-水龍頭 (單處)", "prices": {"一般戶": 1500, "中低收": 2250, "低收入戶": 3000}},
      {"id": "D20", "name": "146居家無障礙設施-改善浴缸", "prices": {"一般戶": 3500, "中低收": 5250, "低收入戶": 7000}},
      {"id": "D21", "name": "147居家無障礙設施-改善洗臉台（槽）", "prices": {"一般戶": 1500, "中低收": 2250, "低收入戶": 3000}},
      {"id": "D22", "name": "148居家無障礙設施-改善馬桶", "prices": {"一般戶": 2500, "中低收": 3750, "低收入戶": 5000}},
      {"id": "D23", "name": "149居家無障礙修繕-馬桶背靠 (單處)", "prices": {"一般戶": 1000, "中低收": 1500, "低收入戶": 2000}},
      {"id": "D24", "name": "153居家無障礙設施-壁掛式淋浴台", "prices": {"一般戶": 2500, "中低收": 3750, "低收入戶": 5000}},
      {"id": "D25", "name": "150居家無障礙設施-改善流理台 (新增、改換)", "prices": {"一般戶": 7500, "中低收": 11250, "低收入戶": 15000}},
      {"id": "D26", "name": "151居家無障礙設施-改善抽油煙機 (位置調整)", "prices": {"一般戶": 500, "中低收": 750, "低收入戶": 1000}},
      {"id": "D27", "name": "163移動式身體清洗槽-局部型", "prices": {"一般戶": 600, "中低收": 900, "低收入戶": 1200}},
      {"id": "D28", "name": "164移動式身體清洗槽-全身型", "prices": {"一般戶": 2500, "中低收": 3750, "低收入戶": 5000}},
      {"id": "D29", "name": "161居家無障礙輔具-馬桶扶手", "prices": {"一般戶": 450, "中低收": 675, "低收入戶": 900}},
      {"id": "D30", "name": "162居家無障礙輔具-床邊扶手", "prices": {"一般戶": 500, "中低收": 750, "低收入戶": 1000}}
    ];

    const ECON_STATUS = ['一般戶', '中低收', '低收入戶'];

    // --- 樣式 ---
    const Card = ({ title, value, colorClass = "bg-white" }) => (
      <div className="flex flex-col items-center p-1 bg-white border border-blue-800 rounded shadow-sm w-full">
        <div className="text-[10px] font-bold text-black whitespace-nowrap">{title}</div>
        <div className={`text-sm font-bold px-1 border border-black w-full text-center truncate ${colorClass}`}>
          {value}
        </div>
      </div>
    );

    const SmallStatCard = ({ title, value, colorClass = "text-gray-800" }) => (
      <div className="flex flex-col items-end gap-0.5 bg-white border border-orange-200 rounded px-1.5 py-0.5 shadow-sm min-w-[70px] justify-between">
        <span className="text-[10px] font-bold text-gray-500">{title}</span>
        <span className={`text-xs font-bold ${colorClass}`}>{value}</span>
      </div>
    );

    const Button = ({ children, onClick, className }) => (
      <button onClick={onClick} className={`px-2 py-1.5 rounded text-white font-bold text-xs shadow active:scale-95 transition-transform flex items-center justify-center gap-1 whitespace-nowrap ${className}`}>{children}</button>
    );

    function App() {
      const [disabilityStatus, setDisabilityStatus] = useState('');
      const [ltcStatus, setLtcStatus] = useState('');
      
      const [isEquipOpen, setIsEquipOpen] = useState(true);
      const [isLtcConstOpen, setIsLtcConstOpen] = useState(true);
      const [isDisConstOpen, setIsDisConstOpen] = useState(true);

      const [equipRows, setEquipRows] = useState([
        { id: 1, productId: '', ltcChecked: false, disChecked: false },
        { id: 2, productId: '', ltcChecked: false, disChecked: false },
        { id: 3, productId: '', ltcChecked: false, disChecked: false },
      ]);

      const [ltcConstRows, setLtcConstRows] = useState([
        { id: 201, productId: '', quantity: 1 },
        { id: 202, productId: '', quantity: 1 },
        { id: 203, productId: '', quantity: 1 }
      ]);

      const [disConstRows, setDisConstRows] = useState([
        { id: 301, productId: '', quantity: 1 },
        { id: 302, productId: '', quantity: 1 },
        { id: 303, productId: '', quantity: 1 }
      ]);
      
      const [constApplyMode, setConstApplyMode] = useState('LTC');

      // --- 計算邏輯 ---
      const calculatedEquipRows = useMemo(() => {
        return equipRows.map(row => {
          const product = EQUIP_DB.find(p => p.id === row.productId);
          if (!product || !disabilityStatus || !ltcStatus) {
            return { ...row, ltcDisplayPrice: 0, disDisplayPrice: 0, ltcQuotaDisplay: 0, diff: 0, activeLtcAmount: 0, activeDisAmount: 0, activeQuota: 0, productName: '' };
          }
          const ltcPrice = product.prices.ltc[ltcStatus] || 0;
          const disPrice = product.prices.disability[disabilityStatus] || 0;
          const quota = product.ltcQuota || 0;
          return {
            ...row,
            ltcDisplayPrice: ltcPrice, disDisplayPrice: disPrice, ltcQuotaDisplay: quota,
            diff: ltcPrice - disPrice,
            activeLtcAmount: row.ltcChecked ? ltcPrice : 0,
            activeDisAmount: row.disChecked ? disPrice : 0,
            activeQuota: row.ltcChecked ? quota : 0,
            productName: product.name
          };
        });
      }, [equipRows, disabilityStatus, ltcStatus]);

      const calculatedLtcConstRows = useMemo(() => {
        return ltcConstRows.map(row => {
          const product = LTC_CONST_DB.find(p => p.id === row.productId);
          const qty = Number(row.quantity) || 0;
          if (!product || !ltcStatus) {
            return { ...row, unitPrice: 0, unitQuota: 0, totalPrice: 0, totalQuota: 0, productName: '' };
          }
          const unitPrice = product.prices[ltcStatus] || 0;
          const unitQuota = product.quota || 0;
          return {
            ...row,
            unitPrice, unitQuota,
            totalPrice: unitPrice * qty,
            totalQuota: unitQuota * qty,
            productName: product.name
          };
        });
      }, [ltcConstRows, ltcStatus]);

      const calculatedDisConstRows = useMemo(() => {
        return disConstRows.map(row => {
          const product = DIS_CONST_DB.find(p => p.id === row.productId);
          const qty = Number(row.quantity) || 0;
          if (!product || !disabilityStatus) {
            return { ...row, unitPrice: 0, totalPrice: 0, productName: '' };
          }
          const unitPrice = product.prices[disabilityStatus] || 0;
          return {
            ...row,
            unitPrice,
            totalPrice: unitPrice * qty,
            productName: product.name
          };
        });
      }, [disConstRows, disabilityStatus]);

      const totals = useMemo(() => {
        const equipTotals = calculatedEquipRows.reduce((acc, row) => ({
          dis: acc.dis + row.activeDisAmount,
          ltc: acc.ltc + row.activeLtcAmount,
          quota: acc.quota + row.activeQuota
        }), { dis: 0, ltc: 0, quota: 0 });

        const ltcConstSubtotal = calculatedLtcConstRows.reduce((acc, r) => ({
            price: acc.price + r.totalPrice,
            quota: acc.quota + r.totalQuota
        }), { price: 0, quota: 0 });

        const disConstSubtotal = calculatedDisConstRows.reduce((acc, r) => acc + r.totalPrice, 0);

        let constLtcTotal = 0, constDisTotal = 0, constQuotaTotal = 0;
        if (constApplyMode === 'LTC') {
            constLtcTotal = ltcConstSubtotal.price;
            constQuotaTotal = ltcConstSubtotal.quota;
        } else if (constApplyMode === 'DISABILITY') {
            constDisTotal = disConstSubtotal;
        }

        return {
          disTotal: equipTotals.dis + constDisTotal,
          ltcTotal: equipTotals.ltc + constLtcTotal,
          quotaTotal: equipTotals.quota + constQuotaTotal,
          ltcConstSubtotalPrice: ltcConstSubtotal.price,
          ltcConstSubtotalQuota: ltcConstSubtotal.quota,
          disConstSubtotalPrice: disConstSubtotal
        };
      }, [calculatedEquipRows, calculatedLtcConstRows, calculatedDisConstRows, constApplyMode]);

      const grandTotal = totals.disTotal + totals.ltcTotal;

      // --- Handlers ---
      const clearAction = (type) => {
        switch(type) {
          case 'ECON': setDisabilityStatus(''); setLtcStatus(''); break;
          case 'EQUIP_ONLY': setEquipRows(equipRows.map(r => ({ ...r, productId: '', ltcChecked: false, disChecked: false }))); break;
          case 'CONST_ONLY': 
            setLtcConstRows([{ id: 201, productId: '', quantity: 1 }, { id: 202, productId: '', quantity: 1 }, { id: 203, productId: '', quantity: 1 }]);
            setDisConstRows([{ id: 301, productId: '', quantity: 1 }, { id: 302, productId: '', quantity: 1 }, { id: 303, productId: '', quantity: 1 }]);
            break;
          case 'LTC_CHECK': setEquipRows(equipRows.map(r => ({ ...r, ltcChecked: false }))); break;
          case 'DIS_CHECK': setEquipRows(equipRows.map(r => ({ ...r, disChecked: false }))); break;
          case 'ALL': 
            setDisabilityStatus(''); setLtcStatus('');
            setEquipRows(equipRows.map(r => ({ ...r, ltcChecked: false, disChecked: false, productId: '' })));
            setLtcConstRows([{ id: 201, productId: '', quantity: 1 }, { id: 202, productId: '', quantity: 1 }, { id: 203, productId: '', quantity: 1 }]);
            setDisConstRows([{ id: 301, productId: '', quantity: 1 }, { id: 302, productId: '', quantity: 1 }, { id: 303, productId: '', quantity: 1 }]);
            break;
        }
      };

      const handleEquipChange = (id, pid) => setEquipRows(equipRows.map(r => r.id === id ? { ...r, productId: pid } : r));
      const handleEquipCheck = (id, field) => setEquipRows(equipRows.map(r => r.id === id ? { ...r, [field]: !r[field] } : r));
      const addEquipRow = () => setEquipRows([...equipRows, { id: Date.now(), productId: '', ltcChecked: false, disChecked: false }]);
      const removeEquipRow = (id) => setEquipRows(equipRows.filter(r => r.id !== id));

      const handleLtcConstChange = (id, field, val) => setLtcConstRows(ltcConstRows.map(r => r.id === id ? { ...r, [field]: val } : r));
      const addLtcConstRow = () => setLtcConstRows([...ltcConstRows, { id: Date.now(), productId: '', quantity: 1 }]);
      const removeLtcConstRow = (id) => setLtcConstRows(ltcConstRows.filter(r => r.id !== id));

      const handleDisConstChange = (id, field, val) => setDisConstRows(disConstRows.map(r => r.id === id ? { ...r, [field]: val } : r));
      const addDisConstRow = () => setDisConstRows([...disConstRows, { id: Date.now(), productId: '', quantity: 1 }]);
      const removeDisConstRow = (id) => setDisConstRows(disConstRows.filter(r => r.id !== id));

      // --- ★★★ 截圖功能 (V16 修正版) ★★★ ---
      const handleScreenshot = () => {
        // 1. 強制捲動到最上方，避免上方被切到
        window.scrollTo(0, 0);

        // 2. 鎖定只截取 content 區域，不抓 body
        const element = document.getElementById('main-content'); 

        html2canvas(element, {
          scale: 3, // 提高解析度 (3倍)，解決變形模糊
          useCORS: true,
          backgroundColor: '#f3f4f6', // 確保背景色正確
          // 忽略那個討厭的直向警告圖層
          ignoreElements: (element) => {
            return element.id === 'orientation-lock'; 
          }
        }).then(canvas => {
          const link = document.createElement('a');
          link.download = `輔具試算表_${new Date().toLocaleDateString()}.png`;
          link.href = canvas.toDataURL();
          link.click();
        });
      };

      return (
        <div className="bg-gray-100 font-sans min-h-screen">
          <div id="orientation-lock" className="fixed inset-0 z-[9999] bg-gray-900 text-white flex flex-col items-center justify-center p-8 text-center portrait:flex landscape:hidden">
             <RotateCcw className="mb-6 animate-pulse text-yellow-400" />
             <h2 className="text-xl font-bold mb-4">請旋轉裝置</h2>
             <p className="text-base text-gray-300">本系統僅支援橫向模式 (Landscape) 使用。</p>
             <Smartphone className="mt-8 text-gray-700 rotate-90" />
          </div>

          {/* 加入 ID 讓截圖程式鎖定 */}
          <div className="portrait:hidden landscape:block w-full px-2 py-3" id="main-content"> 
            
            {/* Header */}
            <div className="bg-white rounded-lg shadow-md mb-3 overflow-hidden border border-gray-200">
              <div className="bg-blue-600 text-white p-1 text-center"><h1 className="text-base font-bold">身障/長照 補助計算機 V16</h1></div>
              <div className="p-2">
                <div className="flex items-end gap-2 mb-2">
                  <div className="space-y-0.5 w-32">
                    <label className="font-bold text-xs block text-gray-700">身障經濟別</label>
                    <select className="w-full border border-gray-300 rounded p-1 text-sm bg-gray-50 h-8" value={disabilityStatus} onChange={(e) => setDisabilityStatus(e.target.value)}>
                      <option value="">請選擇...</option>
                      {ECON_STATUS.map(s => <option key={s} value={s}>{s}</option>)}
                    </select>
                  </div>
                  <div className="space-y-0.5 w-32">
                    <label className="font-bold text-xs block text-gray-700">長照經濟別</label>
                    <select className="w-full border border-gray-300 rounded p-1 text-sm bg-gray-50 h-8" value={ltcStatus} onChange={(e) => setLtcStatus(e.target.value)}>
                      <option value="">請選擇...</option>
                      {ECON_STATUS.map(s => <option key={s} value={s}>{s}</option>)}
                    </select>
                  </div>
                  <div className="flex gap-1 flex-1">
                    <Card title="身障總金額" value={totals.disTotal} />
                    <Card title="長照總金額" value={totals.ltcTotal} />
                    <Card title="總補助" value={grandTotal} />
                    <Card title="長照占用總額度" value={totals.quotaTotal} />
                  </div>
                </div>
                <div className="flex flex-wrap gap-1 items-center">
                  <Button onClick={() => clearAction('ECON')} className="bg-blue-700 hover:bg-blue-600">經濟別清除</Button>
                  <Button onClick={() => clearAction('EQUIP_ONLY')} className="bg-blue-700 hover:bg-blue-600">輔具區清除</Button>
                  <Button onClick={() => clearAction('CONST_ONLY')} className="bg-orange-600 hover:bg-orange-500">無障礙區清除</Button>
                  <Button onClick={() => clearAction('LTC_CHECK')} className="bg-blue-700 hover:bg-blue-600">長照勾勾清除</Button>
                  <Button onClick={() => clearAction('DIS_CHECK')} className="bg-blue-700 hover:bg-blue-600">身障勾勾清除</Button>
                  <Button onClick={() => clearAction('ALL')} className="bg-blue-900 hover:bg-blue-800">總清除</Button>
                  
                  {/* ★★★ 一鍵截圖按鈕 ★★★ */}
                  <Button onClick={handleScreenshot} className="bg-purple-600 hover:bg-purple-500 ml-auto">一鍵截圖</Button>
                </div>
              </div>
            </div>

            {/* 1. 輔具清單 */}
            <div className="mb-3 bg-white rounded-lg shadow-sm border border-blue-200 overflow-hidden">
              <div className="bg-blue-100 p-2 flex justify-between items-center cursor-pointer select-none active:bg-blue-200" onClick={() => setIsEquipOpen(!isEquipOpen)}>
                  <div className="flex items-center gap-1 text-base font-bold text-blue-900">輔具清單</div>
                  <div className="flex items-center gap-2">
                    <button onClick={(e) => { e.stopPropagation(); addEquipRow(); }} className="bg-green-600 text-white hover:bg-green-500 rounded px-2 py-0.5 flex items-center gap-1 shadow text-xs"><Plus size={14}/>新增</button>
                    {isEquipOpen ? <ChevronUp size={18} className="text-blue-700"/> : <ChevronDown size={18} className="text-blue-700"/>}
                  </div>
              </div>
              {isEquipOpen && (
                <div>
                  <div className="flex bg-blue-50 border-b border-gray-200 p-1 font-bold text-[10px] text-blue-900 items-center text-center gap-0.5">
                      <div className="w-[28%] text-left pl-1">項目名稱</div>
                      <div className="w-[6%]">長照</div>
                      <div className="w-[12%]">長照金額</div>
                      <div className="w-[6%]">身障</div>
                      <div className="w-[12%]">身障金額</div>
                      <div className="w-[12%]">差額</div>
                      <div className="w-[12%]">長照占用額度</div>
                      <div className="w-[12%]">操作</div>
                  </div>
                  {calculatedEquipRows.map((row) => (
                    <div key={row.id} className="flex items-center text-xs p-1 border-b border-gray-200 hover:bg-blue-50/50 gap-0.5">
                        <div className="w-[28%] p-0.5"><select className="w-full border border-blue-800 rounded p-0.5 font-bold bg-white text-xs h-8" value={row.productId} onClick={(e) => e.stopPropagation()} onChange={(e) => handleEquipChange(row.id, e.target.value)}><option value="">請選擇...</option>{EQUIP_DB.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select></div>
                        <div className="w-[6%] flex justify-center"><input type="checkbox" checked={row.ltcChecked} onChange={() => handleEquipCheck(row.id, 'ltcChecked')} className="w-4 h-4 cursor-pointer" /></div>
                        <div className="w-[12%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1 text-center font-medium rounded text-xs truncate">{row.ltcDisplayPrice}</div></div>
                        <div className="w-[6%] flex justify-center"><input type="checkbox" checked={row.disChecked} onChange={() => handleEquipCheck(row.id, 'disChecked')} className="w-4 h-4 cursor-pointer" /></div>
                        <div className="w-[12%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1 text-center font-medium rounded text-xs truncate">{row.disDisplayPrice}</div></div>
                        <div className="w-[12%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1 text-center font-medium rounded text-xs truncate">{row.diff}</div></div>
                        <div className="w-[12%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1 text-center font-medium rounded text-xs truncate">{row.ltcQuotaDisplay}</div></div>
                        <div className="w-[12%] flex justify-center"><button onClick={() => removeEquipRow(row.id)} className="text-red-500 hover:text-red-700 p-1"><Trash2 size={16} /></button></div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* ★★★ 無障礙申請管道開關 ★★★ */}
            <div className="mb-3 bg-white rounded-lg shadow-sm border border-gray-200 p-2 flex items-center justify-between">
               <span className="text-sm font-bold text-gray-700">無障礙申請管道：</span>
               <div className="flex gap-4">
                  <label className="flex items-center gap-1 cursor-pointer">
                    <input type="radio" name="applyMode" checked={constApplyMode === 'LTC'} onChange={() => setConstApplyMode('LTC')} className="hidden" />
                    {constApplyMode === 'LTC' ? <CheckCircle className="text-blue-600" /> : <Circle className="text-gray-300" />}
                    <span className={`text-sm font-bold ${constApplyMode === 'LTC' ? 'text-blue-700' : 'text-gray-500'}`}>從長照申請</span>
                  </label>
                  <label className="flex items-center gap-1 cursor-pointer">
                    <input type="radio" name="applyMode" checked={constApplyMode === 'DISABILITY'} onChange={() => setConstApplyMode('DISABILITY')} className="hidden" />
                    {constApplyMode === 'DISABILITY' ? <CheckCircle className="text-green-600" /> : <Circle className="text-gray-300" />}
                    <span className={`text-sm font-bold ${constApplyMode === 'DISABILITY' ? 'text-green-700' : 'text-gray-500'}`}>從身障申請</span>
                  </label>
               </div>
               <div className="text-xs text-gray-400">(勾選的項目才會加總到最上方總表)</div>
            </div>

            {/* 2. 長照無障礙區 */}
            <div className="mb-3 bg-white rounded-lg shadow-sm border border-blue-300 overflow-hidden">
              <div className="bg-blue-50 p-2 flex justify-between items-center cursor-pointer select-none active:bg-blue-100" onClick={() => setIsLtcConstOpen(!isLtcConstOpen)}>
                  <div className="flex items-center gap-3">
                      <span className="text-base font-bold text-blue-800">長照無障礙項目</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <SmallStatCard title="無障礙長照總額" value={totals.ltcConstSubtotalPrice} colorClass="text-blue-700"/>
                    <SmallStatCard title="無障礙長照額度" value={totals.ltcConstSubtotalQuota} colorClass="text-gray-700"/>
                    <button onClick={(e) => { e.stopPropagation(); addLtcConstRow(); }} className="bg-blue-600 text-white hover:bg-blue-500 rounded px-2 py-0.5 flex items-center gap-1 shadow text-xs"><Plus size={14}/>新增</button>
                    {isLtcConstOpen ? <ChevronUp size={18} className="text-blue-700"/> : <ChevronDown size={18} className="text-blue-700"/>}
                  </div>
              </div>
              {isLtcConstOpen && (
                <div>
                  <div className="flex bg-gray-50 border-b border-gray-200 p-1 font-bold text-[10px] text-gray-700 items-center text-center gap-0.5">
                      <div className="w-[30%] text-left pl-1">長照項目</div>
                      <div className="w-[15%]">長照單組金額</div>
                      <div className="w-[10%]">組數</div>
                      <div className="w-[15%]">長照單項金額</div>
                      <div className="w-[15%]">單項額度</div>
                      <div className="w-[15%]">操作</div>
                  </div>
                  {calculatedLtcConstRows.map((row) => (
                    <div key={row.id} className="flex items-center text-xs p-1 border-b border-gray-100 hover:bg-blue-50 gap-0.5">
                        <div className="w-[30%] p-0.5"><select className="w-full border border-blue-300 rounded p-0.5 font-bold bg-white text-xs h-8" value={row.productId} onClick={(e) => e.stopPropagation()} onChange={(e) => handleLtcConstChange(row.id, 'productId', e.target.value)}><option value="">請選擇長照項目...</option>{LTC_CONST_DB.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select></div>
                        <div className="w-[15%] px-0.5"><div className="text-center font-medium">{row.unitPrice}</div></div>
                        <div className="w-[10%] px-0.5"><input type="number" step="0.01" min="0" className="w-full border border-blue-300 rounded p-0.5 font-bold text-center text-xs h-8" value={row.quantity} onClick={(e) => e.stopPropagation()} onChange={(e) => handleLtcConstChange(row.id, 'quantity', e.target.value)} /></div>
                        <div className="w-[15%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1.5 text-center font-medium rounded text-xs text-blue-700 truncate">{row.totalPrice}</div></div>
                        <div className="w-[15%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1.5 text-center font-medium rounded text-xs text-gray-700 truncate">{row.totalQuota}</div></div>
                        <div className="w-[15%] flex justify-center"><button onClick={() => removeLtcConstRow(row.id)} className="text-red-500 hover:text-red-700 p-1"><Trash2 size={16} /></button></div>
                    </div>
                  ))}
                </div>
              )}
            </div>

            {/* 3. 身障無障礙區 */}
            <div className="mb-3 bg-white rounded-lg shadow-sm border border-green-300 overflow-hidden">
              <div className="bg-green-50 p-2 flex justify-between items-center cursor-pointer select-none active:bg-green-100" onClick={() => setIsDisConstOpen(!isDisConstOpen)}>
                  <div className="flex items-center gap-3">
                      <span className="text-base font-bold text-green-800">身障無障礙項目</span>
                  </div>
                  <div className="flex items-center gap-2">
                    <SmallStatCard title="無障礙身障總額" value={totals.disConstSubtotalPrice} colorClass="text-green-700"/>
                    <button onClick={(e) => { e.stopPropagation(); addDisConstRow(); }} className="bg-green-600 text-white hover:bg-green-500 rounded px-2 py-0.5 flex items-center gap-1 shadow text-xs"><Plus size={14}/>新增</button>
                    {isDisConstOpen ? <ChevronUp size={18} className="text-green-700"/> : <ChevronDown size={18} className="text-green-700"/>}
                  </div>
              </div>
              {isDisConstOpen && (
                <div>
                  <div className="flex bg-gray-50 border-b border-gray-200 p-1 font-bold text-[10px] text-gray-700 items-center text-center gap-0.5">
                      <div className="w-[45%] text-left pl-1">身障項目</div>
                      <div className="w-[15%]">身障單組金額</div>
                      <div className="w-[10%]">組數</div>
                      <div className="w-[15%]">身障單項金額</div>
                      <div className="w-[15%]">操作</div>
                  </div>
                  {calculatedDisConstRows.map((row) => (
                    <div key={row.id} className="flex items-center text-xs p-1 border-b border-gray-100 hover:bg-green-50 gap-0.5">
                        <div className="w-[45%] p-0.5"><select className="w-full border border-green-300 rounded p-0.5 font-bold bg-white text-xs h-8" value={row.productId} onClick={(e) => e.stopPropagation()} onChange={(e) => handleDisConstChange(row.id, 'productId', e.target.value)}><option value="">請選擇身障項目...</option>{DIS_CONST_DB.map(p => <option key={p.id} value={p.id}>{p.name}</option>)}</select></div>
                        <div className="w-[15%] px-0.5"><div className="text-center font-medium">{row.unitPrice}</div></div>
                        <div className="w-[10%] px-0.5"><input type="number" step="0.01" min="0" className="w-full border border-green-300 rounded p-0.5 font-bold text-center text-xs h-8" value={row.quantity} onClick={(e) => e.stopPropagation()} onChange={(e) => handleDisConstChange(row.id, 'quantity', e.target.value)} /></div>
                        <div className="w-[15%] px-0.5"><div className="border border-gray-300 bg-white px-0.5 py-1.5 text-center font-medium rounded text-xs text-green-700 truncate">{row.totalPrice}</div></div>
                        <div className="w-[15%] flex justify-center"><button onClick={() => removeDisConstRow(row.id)} className="text-red-500 hover:text-red-700 p-1"><Trash2 size={16} /></button></div>
                    </div>
                  ))}
                </div>
              )}
            </div>

          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);

    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./service-worker.js');
    }
  </script>
</body>
</html>